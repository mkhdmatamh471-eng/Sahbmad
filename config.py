import re
import os
import asyncio

# --- 1. إصلاح تعريف الروابط والمتغيرات ---
# جلب الرابط من البيئة، وإذا لم يوجد نضع قيمة فارغة لتجنب الـ NameError

BOT_TOKEN = os.environ.get("BOT_TOKEN", "8498451295:AAGt1R7THllSjYtEe5hvIEPnPhRkS_iBcnU")


# --- 2. إعدادات الأحياء (المدينة المنورة) ---
CITIES_DISTRICTS = {
    "المدينة المنورة": [
        "أبو مرخة", "أبيار علي", "الأسواف", "البخاري", "الإسكان", "البحر", 
        "البدراني", "الجمعة", "الجرف", "الحزام", "الحمراء", "الخاتم", "الخالدية", 
        "الدائرة", "الدائري", "الدويخله", "الدويمة", "الدعيثة", "الرانونا", "الرناونة", 
        "الربوة", "السيح", "الشروق", "الشرق", "الشهداء", "الشيبية", "الظاهرة", 
        "العاقول", "العالية", "العوالي", "العريض", "العزيزية", "العصبة", 
        "العنابس", "العنبرية", "العيون", "الفتح", "القبلتين", "القارات", "المبعوث", 
        "المطار", "المغيسله", "الملك فهد", "الملك فيصل", "المناخة", "المصانع", 
        "النور", "النبلاء", "النقيع", "النقمي", "الهجرة", "الواحة", "الوادي", 
        "بئر الماشي", "بئر عثمان", "باقدو", "بني حارثة", "بني ظفر", "تلال علي", 
        "تلال", "حمراء الأسد", "دفاع", "ذو الحليفة", "رهط", "سيد الشهداء", 
        "سلطانة", "سكة الحديد", "السقيا", "شظاة", "شوران", "عروة", "قباء", 
        "قربان", "مخطط التلال", "مهزور", "وعيرة", "العصيبي", "تلعة الهبوب", 
        "الزهراء", "الفيحاء", "المنار", "سكن الحرس", "السديري", "المطار القديم",
        "الحرم", "المسجد النبوي", "مسجد قباء", "مسجد القبلتين", "جامعة طيبة", 
        "الجامعة الإسلامية", "النور مول", "الراشد مول", "العالية مول"
    ]
}

# --- 3. دالة معالجة النصوص (المحسنة) ---
def normalize_text(text):
    """تنظيف وتوحيد النصوص العربية لزيادة دقة البحث"""
    if not text: return ""
    text = text.strip().lower()
    text = re.sub(r"[\u064B-\u0652]", "", text) # إزالة التشكيل
    
    replacements = {
        "أ": "ا", "إ": "ا", "آ": "ا",
        "ة": "ه", "ى": "ي", "ئ": "ي", "ؤ": "و"
    }
    for old, new in replacements.items():
        text = text.replace(old, new)
    
    # إزالة ال التعريف من الكلمات الطويلة لزيادة مطابقة الأحياء
    words = text.split()
    clean_words = [w[2:] if w.startswith("ال") and len(w) > 3 else w for w in words]
    return " ".join(clean_words)

# ملاحظة: تم حذف دوال قاعدة البيانات (init_db, pool) لأن الرادار لا يحتاجها 
# ليعمل الملف كـ Config صافي وخفيف.
